<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<title>ZÃ¤hler Dashboard</title>
<style>
body { font-family: sans-serif; background: #f5f6fa; text-align: center; margin: 0; padding: 0; }
.counter {
    display: inline-block;
    width: 250px;
    margin: 20px;
    padding: 20px;
    border-radius: 20px;
    background: white;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    position: relative;
    overflow: hidden;
}
button {
    border: none; border-radius: 10px;
    background: #3498db; color: white;
    padding: 10px 20px; margin-top: 10px;
    cursor: pointer; transition: 0.3s;
}
button:hover { background: #2980b9; }
.delete { position: absolute; top: 10px; right: 10px; color: red; text-decoration: none; }
.logout { position: fixed; top: 20px; right: 20px; text-decoration: none; color: #333; }
.bar {
    height: 10px;
    background: #ddd;
    border-radius: 5px;
    overflow: hidden;
    margin-bottom: 8px;
}
.bar-fill {
    height: 10px;
    width: 0%;
    border-radius: 5px;
    transition: width 0.5s ease;
}
</style>
</head>
<body>
<h1>Willkommen, {{ user }} ðŸ‘‹</h1>
<a href="/logout" class="logout">Logout</a>

<div>
    {% for name, c in data.counters.items() %}
    <div class="counter" style="border-top: 5px solid {{ c.color }};">
        <h3>{{ name }}</h3>
        <div class="bar">
            <div class="bar-fill" id="bar-{{ name }}" style="background: {{ c.color }};"></div>
        </div>
        <p>Woche: {{ c.weekly_count }} / 6</p>
        <p>Gesamt: {{ c.total_count }}</p>

        <form action="/click/{{ name }}">
            <button type="submit" onclick="triggerConfetti('{{ name }}')">+1</button>
        </form>

        <a href="/show_qrcode/{{ name }}"><button>QR-Code</button></a>

        {% if user == 'Leroy' %}
        <a href="/reset_weekly/{{ name }}"><button>Woche zurÃ¼cksetzen</button></a>
        <a href="/reset_total/{{ name }}"><button>Gesamt zurÃ¼cksetzen</button></a>
        {% endif %}
    </div>
    {% endfor %}
</div>

<script>
// Balken-Animation
document.querySelectorAll('.bar-fill').forEach(b => {
    const pct = parseInt(b.parentElement.nextElementSibling.textContent.match(/\d+/)[0]) / 6 * 100;
    setTimeout(() => b.style.width = pct + '%', 300);
});

// Konfettikanone ðŸŽ‰
function triggerConfetti(counterName) {
    const colors = ["#e67e22","#9b59b6","#3498db","#2ecc71","#f1c40f","#e74c3c"];
    const originX = window.innerWidth / 2;
    const originY = window.innerHeight - 100;

    for (let i = 0; i < 100; i++) {
        const confetti = document.createElement("div");
        confetti.classList.add("confetti");
        const size = Math.random() * 8 + 4;
        confetti.style.width = `${size}px`;
        confetti.style.height = `${size}px`;
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.position = "fixed";
        confetti.style.left = originX + "px";
        confetti.style.top = originY + "px";
        confetti.style.zIndex = 9999;
        document.body.appendChild(confetti);

        const angle = Math.random() * Math.PI - Math.PI / 2;
        const speed = Math.random() * 10 + 6;
        const xVel = Math.cos(angle) * speed;
        const yVel = Math.sin(angle) * speed - 10;
        let x = originX, y = originY;
        const gravity = 0.3;

        const interval = setInterval(() => {
            x += xVel;
            y += yVel;
            yVel += gravity;
            confetti.style.left = x + "px";
            confetti.style.top = y + "px";
            confetti.style.transform = `rotate(${x + y}deg)`;
            if (y > window.innerHeight) {
                clearInterval(interval);
                confetti.remove();
            }
        }, 16);
    }
}
</script>
</body>
</html>
